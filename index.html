<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Math Riddles Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --accent: #00e6e6;
      --bg-dark: #0a0a0a;
      --font: 'Segoe UI', sans-serif;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: var(--font);
      background: var(--bg-dark);
      color: white;
      height: 100%;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      opacity: 0;
      animation: fadeIn 1s ease-out forwards;
      animation-delay: 2.5s;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .screen {
      display: none;
      width: 100%;
      height: 100%;
      max-width: 500px;
      padding: 30px 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .active {
      display: block;
    }

    h1, h2 {
      color: var(--accent);
      text-align: center;
    }

    h1 {
      font-size: 42px;
      text-shadow: 0 0 12px var(--accent);
      margin-bottom: 50px;
    }

    h2 {
      font-size: 28px;
      margin-bottom: 20px;
    }

    .btn {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 16px;
      font-size: 18px;
      border-radius: 12px;
      margin: 10px auto;
      display: block;
      width: 90%;
      cursor: pointer;
    }

    .btn:hover {
      background: #00bdbd;
    }

    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 25px 0;
    }

    .keypad button {
      padding: 20px;
      font-size: 24px;
      background: #00bcd4;
      color: white;
      border: none;
      border-radius: 10px;
    }

    .answer-box, .result {
      font-size: 22px;
      text-align: center;
      margin-top: 15px;
    }

    .result {
      color: #ffd54f;
    }

    .level-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
    }

    .level-grid button {
      padding: 14px;
      border-radius: 8px;
      background-color: #333;
      color: #fff;
    }

    .level-grid button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .toggle-container {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
    }

    .toggle-container label {
      font-size: 18px;
    }

    input[type="checkbox"] {
      transform: scale(1.5);
    }

    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: var(--bg-dark);
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 2000;
      animation: splashFade 2.5s ease-out forwards;
    }

    @keyframes splashFade {
      0%, 90% { opacity: 1; }
      100% { opacity: 0; visibility: hidden; }
    }

    .logo {
      font-size: 64px;
      animation: logoAnim 2s ease-in-out infinite;
    }

    @keyframes logoAnim {
      0% { transform: scale(1) rotate(0); }
      30% { transform: scale(1.15) rotate(15deg); }
      60% { transform: scale(0.95) rotate(-10deg); }
      100% { transform: scale(1) rotate(0); }
    }
  </style>
</head>
<body>
  <div id="splash">
    <div class="logo">üß†</div>
    <div>Math Riddles</div>
  </div>

  <div class="container">
    <div id="homeScreen" class="screen active">
      <h1>üß† Math Riddles</h1>
      <button class="btn" onclick="startGame()">‚ñ∂ Play</button>
      <button class="btn" onclick="showScreen('levelsScreen')">üìö Levels</button>
      <button class="btn" onclick="showScreen('settingsScreen')">‚öôÔ∏è Settings</button>
      <button class="btn" onclick="window.close()">‚ùå Quit</button>
    </div>

    <div id="settingsScreen" class="screen">
      <h2>Settings</h2>
      <div class="toggle-container">
        <label for="musicToggle">üéµ Music</label>
        <input type="checkbox" id="musicToggle" onchange="toggleMusic(this)">
      </div>
      <button class="btn" onclick="showScreen('homeScreen')">‚¨Ö Back</button>
    </div>

    <div id="levelsScreen" class="screen">
      <h2>Select Level</h2>
      <div class="level-grid" id="levelButtons"></div>
      <button class="btn" onclick="showScreen('homeScreen')">‚¨Ö Back</button>
    </div>

    <div id="riddleScreen" class="screen">
      <h2 id="levelTitle">Level</h2>
      <div id="questionText" style="text-align:center"></div>
      <div class="answer-box" id="answerBox"></div>
      <div class="keypad">
        <button onclick="press(1)">1</button>
        <button onclick="press(2)">2</button>
        <button onclick="press(3)">3</button>
        <button onclick="press(4)">4</button>
        <button onclick="press(5)">5</button>
        <button onclick="press(6)">6</button>
        <button onclick="press(7)">7</button>
        <button onclick="press(8)">8</button>
        <button onclick="press(9)">9</button>
        <button onclick="clearAnswer()">C</button>
        <button onclick="press(0)">0</button>
        <button onclick="submitAnswer()">‚úì</button>
      </div>
      <div class="result" id="resultMsg"></div>
      <button class="btn" onclick="showHint()">Hint</button>
      <button class="btn" onclick="showSolution()">Solution</button>
      <button class="btn" onclick="showScreen('homeScreen')">‚¨Ö Back</button>
    </div>
  </div>

  <audio id="bgMusic" src="bg-music.mp3" loop></audio>

  <script>
    setTimeout(() => document.getElementById("splash").style.display = "none", 2500);

    const riddles = [
      { question: "I am 2-digit. Reversed I am 27 more. Digits add to 9.", answer: "36", hint: "Reverse: 63", solution: "63 - 36 = 27" },
      { question: "Divide 30 by half and add 10.", answer: "70", hint: "Divide by 0.5", solution: "30 √∑ 0.5 + 10 = 70" },
      { question: "Smallest 3-digit Armstrong number?", answer: "153", hint: "1¬≥+5¬≥+3¬≥", solution: "1+125+27=153" },
    ];

    while (riddles.length < 50) {
      const n = riddles.length + 1;
      riddles.push({
        question: `What is ${n} √ó ${n} + 1?`,
        answer: (n * n + 1).toString(),
        hint: "Square + 1",
        solution: `${n} √ó ${n} + 1 = ${n * n + 1}`
      });
    }

    let currentLevel = parseInt(localStorage.getItem("currentLevel") || "1");
    let solved = JSON.parse(localStorage.getItem("solvedLevels") || "[]");
    let userAnswer = "";

    const music = document.getElementById("bgMusic");
    const musicToggle = document.getElementById("musicToggle");

    window.onload = () => {
      music.volume = 0.3;
      if (localStorage.getItem("music") !== "off") {
        musicToggle.checked = true;
        music.play().catch(() => {
          document.addEventListener("click", () => music.play(), { once: true });
        });
      }
      renderLevels();
    };

    function toggleMusic(checkbox) {
      if (checkbox.checked) {
        music.play();
        localStorage.setItem("music", "on");
      } else {
        music.pause();
        localStorage.setItem("music", "off");
      }
    }

    function showScreen(id) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function startGame() {
      loadLevel(currentLevel);
    }

    function renderLevels() {
      const grid = document.getElementById("levelButtons");
      grid.innerHTML = "";
      riddles.forEach((_, i) => {
        const btn = document.createElement("button");
        btn.textContent = solved.includes(i + 1) ? `‚úÖ ${i + 1}` : `üîí ${i + 1}`;
        btn.disabled = !solved.includes(i + 1) && (i + 1 !== currentLevel);
        btn.onclick = () => loadLevel(i + 1);
        grid.appendChild(btn);
      });
    }

    function loadLevel(level) {
      const r = riddles[level - 1];
      currentLevel = level;
      userAnswer = "";
      document.getElementById("levelTitle").textContent = `Level ${level}`;
      document.getElementById("questionText").textContent = r.question;
      document.getElementById("answerBox").textContent = "";
      document.getElementById("resultMsg").textContent = "";
      showScreen("riddleScreen");
    }

    function press(n) {
      userAnswer += n;
      document.getElementById("answerBox").textContent = userAnswer;
    }

    function clearAnswer() {
      userAnswer = "";
      document.getElementById("answerBox").textContent = "";
    }

    function submitAnswer() {
      const r = riddles[currentLevel - 1];
      const msg = document.getElementById("resultMsg");
      if (userAnswer === r.answer) {
        msg.textContent = "üéâ Correct!";
        if (!solved.includes(currentLevel)) {
          solved.push(currentLevel);
          localStorage.setItem("solvedLevels", JSON.stringify(solved));
        }
        currentLevel++;
        localStorage.setItem("currentLevel", currentLevel);
        setTimeout(() => {
          if (currentLevel <= riddles.length) loadLevel(currentLevel);
          else alert("üéä All levels completed!");
        }, 1000);
      } else {
        msg.textContent = "‚ùå Wrong!";
        setTimeout(clearAnswer, 800);
      }
    }

    function showHint() {
      alert("Hint: " + riddles[currentLevel - 1].hint);
    }

    function showSolution() {
      alert("Solution: " + riddles[currentLevel - 1].solution);
    }

    window.onpopstate = () => {
      showScreen("homeScreen");
      history.pushState(null, "", location.href);
    };
    history.pushState(null, "", location.href);
  </script>
</body>
</html>
