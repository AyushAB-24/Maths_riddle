<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Riddles Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --accent: #00e6e6;
      --bg-dark: #121212;
      --bg-card: #1e1e1e;
      --font: 'Segoe UI', sans-serif;
    }
    body, html {
      margin: 0;
      padding: 0;
      font-family: var(--font);
      background: var(--bg-dark);
      color: #fff;
      height: 100%;
      overflow-x: hidden;
    }
    .container {
      max-width: 500px;
      margin: auto;
      padding: 20px;
    }
    .screen {
      display: none;
      background: var(--bg-card);
      border-radius: 12px;
      padding: 25px 15px;
      box-shadow: 0 0 15px rgba(0,255,255,0.1);
      transition: all 0.3s ease-in-out;
    }
    .active {
      display: block;
    }
    h1, h2 {
      color: var(--accent);
      margin: 10px 0 20px;
    }
    .btn {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 14px 20px;
      border-radius: 10px;
      font-size: 17px;
      margin: 10px auto;
      display: block;
      width: 90%;
      cursor: pointer;
      transition: 0.2s ease;
    }
    .btn:hover {
      background: #00bdbd;
    }
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 25px 0;
    }
    .keypad button {
      padding: 18px;
      font-size: 22px;
      background: #00bcd4;
      color: white;
      border: none;
      border-radius: 10px;
    }
    .answer-box {
      font-size: 26px;
      color: #ffd54f;
      margin: 15px;
      min-height: 30px;
    }
    .result {
      font-size: 18px;
      margin-top: 10px;
      min-height: 25px;
    }
    .level-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin: 20px 0;
    }
    .level-grid button {
      padding: 12px;
      border-radius: 8px;
      background-color: #333;
      color: #fff;
      border: 1px solid #444;
    }
    .level-grid button:disabled {
      opacity: 0.3;
      cursor: default;
    }
    .toggle-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      margin-top: 15px;
    }
    .toggle-container label {
      font-size: 18px;
    }
    input[type="checkbox"] {
      transform: scale(1.5);
    }
    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 1000;
    }
  </style>
</head>
<body>

<div class="container">

  <!-- Home Screen -->
  <div id="homeScreen" class="screen active">
    <h1>üß† Math Riddles</h1>
    <button class="btn" onclick="startGame()">‚ñ∂ Play</button>
    <button class="btn" onclick="showScreen('levelsScreen')">üìö Levels</button>
    <button class="btn" onclick="showScreen('settingsScreen')">‚öôÔ∏è Settings</button>
    <button class="btn" onclick="window.close()">‚ùå Quit</button>
  </div>

  <!-- Settings Screen -->
  <div id="settingsScreen" class="screen">
    <h2>Settings</h2>
    <div class="toggle-container">
      <label for="musicToggle">üéµ Background Music</label>
      <input type="checkbox" id="musicToggle" onchange="toggleMusic(this)">
    </div>
    <button class="btn" onclick="showScreen('homeScreen')">‚¨Ö Back</button>
  </div>

  <!-- Levels -->
  <div id="levelsScreen" class="screen">
    <h2>Select Level</h2>
    <div class="level-grid" id="levelButtons"></div>
    <button class="btn" onclick="showScreen('homeScreen')">‚¨Ö Back</button>
  </div>

  <!-- Riddle -->
  <div id="riddleScreen" class="screen">
    <h2 id="levelTitle">Level</h2>
    <div id="questionText">Question will appear here</div>
    <div class="answer-box" id="answerBox"></div>

    <div class="keypad">
      <button onclick="press(1)">1</button>
      <button onclick="press(2)">2</button>
      <button onclick="press(3)">3</button>
      <button onclick="press(4)">4</button>
      <button onclick="press(5)">5</button>
      <button onclick="press(6)">6</button>
      <button onclick="press(7)">7</button>
      <button onclick="press(8)">8</button>
      <button onclick="press(9)">9</button>
      <button onclick="clearAnswer()">C</button>
      <button onclick="press(0)">0</button>
      <button onclick="submitAnswer()">‚úì</button>
    </div>

    <div class="result" id="resultMsg"></div>

    <button class="btn" onclick="showHint()">Hint</button>
    <button class="btn" onclick="showSolution()">Solution</button>
    <button class="btn" onclick="showScreen('homeScreen')">üè† Home</button>
  </div>
</div>

<canvas id="confetti-canvas"></canvas>

<!-- Sounds -->
<audio id="bgMusic" src="bg-music.mp3" loop></audio>
<audio id="clickSound" src="click.mp3"></audio>

<script>
  const riddles = [
    { question: "I am 2-digit. Reversed I am 27 more. Digits add to 9. What am I?", answer: "36", hint: "Reverse: 63", solution: "63 - 36 = 27" },
    { question: "Divide 30 by half and add 10.", answer: "70", hint: "Divide by 0.5", solution: "30 √∑ 0.5 + 10 = 70" },
    { question: "Smallest 3-digit Armstrong number?", answer: "153", hint: "1¬≥+5¬≥+3¬≥", solution: "1+125+27=153" }
  ];
  while (riddles.length < 50) {
    let n = riddles.length + 1;
    riddles.push({
      question: `What is ${n} √ó ${n} + 1?`,
      answer: (n * n + 1).toString(),
      hint: `Square + 1`,
      solution: `${n} √ó ${n} + 1 = ${n * n + 1}`
    });
  }

  let currentLevel = parseInt(localStorage.getItem("currentLevel") || "1");
  let solved = JSON.parse(localStorage.getItem("solvedLevels") || "[]");
  let userAnswer = "";
  const music = document.getElementById("bgMusic");
  const click = document.getElementById("clickSound");
  const musicToggle = document.getElementById("musicToggle");

  window.onload = () => {
    try { music.volume = 0.4; } catch {}
    if (localStorage.getItem("music") !== "off") {
      musicToggle.checked = true;
      music.play().catch(() => {});
    } else {
      musicToggle.checked = false;
      music.pause();
    }
    renderLevels();
  };

  function toggleMusic(checkbox) {
    if (checkbox.checked) {
      music.play();
      localStorage.setItem("music", "on");
    } else {
      music.pause();
      localStorage.setItem("music", "off");
    }
  }

  function playClick() { click.play(); }

  function showScreen(id) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  function startGame() {
    loadLevel(currentLevel);
  }

  function renderLevels() {
    const grid = document.getElementById("levelButtons");
    grid.innerHTML = "";
    riddles.forEach((_, i) => {
      const btn = document.createElement("button");
      btn.textContent = solved.includes(i + 1) ? `‚úÖ ${i + 1}` : `üîí ${i + 1}`;
      btn.disabled = !solved.includes(i + 1) && (i + 1 !== currentLevel);
      btn.onclick = () => loadLevel(i + 1);
      grid.appendChild(btn);
    });
  }

  function loadLevel(level) {
    clearConfetti();
    const r = riddles[level - 1];
    currentLevel = level;
    userAnswer = "";
    document.getElementById("levelTitle").textContent = `Level ${level}`;
    document.getElementById("questionText").textContent = r.question;
    document.getElementById("answerBox").textContent = "";
    document.getElementById("resultMsg").textContent = "";
    showScreen("riddleScreen");
  }

  function press(n) {
    playClick();
    userAnswer += n;
    document.getElementById("answerBox").textContent = userAnswer;
    document.getElementById("resultMsg").textContent = "";
  }

  function clearAnswer() {
    playClick();
    userAnswer = "";
    document.getElementById("answerBox").textContent = "";
    document.getElementById("resultMsg").textContent = "";
  }

  function submitAnswer() {
    const r = riddles[currentLevel - 1];
    const msg = document.getElementById("resultMsg");
    if (userAnswer === r.answer) {
      msg.textContent = "üéâ Correct!";
      msg.style.color = "#00e676";
      fireConfetti(() => {
        if (!solved.includes(currentLevel)) {
          solved.push(currentLevel);
          localStorage.setItem("solvedLevels", JSON.stringify(solved));
        }
        currentLevel++;
        localStorage.setItem("currentLevel", currentLevel);
        setTimeout(() => {
          if (currentLevel <= riddles.length) loadLevel(currentLevel);
          else alert("üéä All levels completed!");
        }, 1000);
      });
    } else {
      msg.textContent = "‚ùå Wrong!";
      msg.style.color = "#e53935";
      setTimeout(clearAnswer, 800);
    }
  }

  function showHint() {
    alert("Hint: " + riddles[currentLevel - 1].hint + "\n(Ad would show here)");
  }

  function showSolution() {
    alert("Solution: " + riddles[currentLevel - 1].solution + "\n(Ad would show here)");
  }

  function fireConfetti(callback) {
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const pieces = Array.from({ length: 100 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: Math.random() * 10 + 5,
      color: `hsl(${Math.random() * 360}, 100%, 50%)`,
      speed: Math.random() * 3 + 2
    }));
    let frame = 0;
    const anim = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      pieces.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y += p.speed, p.size, p.size);
      });
      frame++;
      if (frame < 60) requestAnimationFrame(anim);
      else {
        clearConfetti();
        if (callback) callback();
      }
    };
    anim();
  }

  function clearConfetti() {
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
</script>
</body>
</html>
